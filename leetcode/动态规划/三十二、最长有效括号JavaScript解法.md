## 最长有效括号

给定一个只包含 '(' 和 ')' 的字符串，找出最长的包含有效括号的子串的长度。

示例 1:

输入: "(()"
输出: 2
解释: 最长有效括号子串为 "()"
示例 2:

输入: ")()())"
输出: 4
解释: 最长有效括号子串为 "()()"

### 解法-动态规划
定义一个dp数组，其中第i个元素表示以下标为i的字符结尾的最长有效子字符串的长度。将dp数组为0。有效的子字符串一定以')'结尾。这进一步得出结论，以'('结尾的子字符串对应的dp数组位置上的值必定为0，所以只需更新在dp数组中对应位置的值。<br>
为了求出dp数组，每两个字符检测一次<br>
1、如果满足条件s[i]==')'且s[i-1]=='('也就是'...()'<br>
**dp[i] = dp[i-1] + 2;**<br>
结束部分是一个有效字符串，并且将之前有效字符串的长度增加2<br>
2、s[i]=')'且s[i-1]=')'如'...(('可以推出，如果s[i - dp[i-1] -1]=='('那么<br>
**dp[i] = dp[i-1] + dp[i-dp[i-1]-2]+2**<br>
如果倒数第二个')'是一个有效字符串的一部分记为subs，对最后一个')',如果它是一个更长的字符串的一部分，那它一定有一个对应的'(',它的位置在倒数第二个')'，所在字符串的前面（也就是subs的前面）。因此如果字符串subs的前面恰好是'('就是用2加上subs的长度(dp[i-1])去更新dp[i]，除此之外，也会把有效字符串'(, subs, )'之前的有效字符串的长度也加上，也就是加上dp[i-dp[i-1]-2]<br>

执行用时 :64 ms, 在所有 javascript 提交中击败了98.39%的用户<br>
内存消耗 :35.7 MB, 在所有 javascript 提交中击败了94.29%的用户
```
/**
 * @param {string} s
 * @return {number}
 */
var longestValidParentheses = function(s) {
    let max = 0;
    let dp = [];
    dp.length = s.length;
    dp.fill(0);
    for (let i=1; i<s.length; i++) {
        if (s[i] === ')') {
            if (s[i-1] === '(') {
                dp[i] = (i >= 2 ? dp[i-2] : 0) + 2;
            } else if (i-dp[i-1] > 0 && s[i - dp[i-1] - 1] === '(') {
                dp[i] = dp[i-1] + ((i-dp[i-1]) >= 2 ? dp[i-dp[i-1] - 2] : 0) + 2
            }
            max = Math.max(max, dp[i]);
        }
    }
    return max;
};
```